{% extends "base.html" %}

{% block title %}Generate Hybrid Schedule{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>ðŸ”¬ Hybrid Schedule Generation</h2>
    <p class="text-muted">Using Genetic Algorithm + OR-Tools</p>
    
    <hr>
    
    <!-- System Overview -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5><i class="fas fa-info-circle"></i> How It Works</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><strong>Phase 1: Genetic Algorithm</strong></h6>
                            <ul>
                                <li>Assigns lecturers to sections</li>
                                <li>Creates section names (A1, A2, A3, ...)</li>
                                <li>Balances workload across lecturers</li>
                                <li>Respects lecturer preferences</li>
                            </ul>
                            <p class="text-muted"><small>Example: Pemweb A1-A2 (Dosen A), A3-A4 (Dosen B)</small></p>
                        </div>
                        <div class="col-md-6">
                            <h6><strong>Phase 2: OR-Tools</strong></h6>
                            <ul>
                                <li>Schedules timeslots for each section</li>
                                <li>Assigns rooms without conflicts</li>
                                <li><strong>Guarantees NO conflicts</strong></li>
                                <li>Respects consecutive time slots</li>
                            </ul>
                            <p class="text-muted"><small>Result: Complete schedule with no overlaps</small></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Current Statistics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3>{{ courses|length }}</h3>
                    <p class="text-muted">Courses</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3>{{ total_sections }}</h3>
                    <p class="text-muted">Sections to Schedule</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3>{{ total_lecturers }}</h3>
                    <p class="text-muted">Lecturers</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3>~5 min</h3>
                    <p class="text-muted">Est. Time</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Warning Box -->
    <div class="alert alert-warning" role="alert">
        <h5><i class="fas fa-exclamation-triangle"></i> Before You Start</h5>
        <ul class="mb-0">
            <li>Make sure all lecturers have selected their preferred courses</li>
            <li>Verify that course data (SKS, is_lab) is correct</li>
            <li>This will <strong>replace all existing schedules</strong></li>
            <li>Process may take 3-10 minutes depending on data size</li>
        </ul>
    </div>
    
    <!-- Action Buttons -->
    <div class="row">
        <div class="col-md-12 text-center">
            <form method="POST" action="{{ url_for('generate_hybrid_schedule') }}" onsubmit="return confirm('This will replace all existing schedules. Continue?')">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-rocket"></i> Generate Schedule Now
                </button>
            </form>
            
            <div class="mt-3">
                <a href="{{ url_for('koordinator_schedule') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Schedule
                </a>
            </div>
        </div>
    </div>
    
    <!-- Progress Info -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5>Expected Process</h5>
                </div>
                <div class="card-body">
                    <ol>
                        <li><strong>Phase 1 (GA):</strong> Assigning sections to lecturers... (2-3 minutes)</li>
                        <li><strong>Phase 2 (OR-Tools):</strong> Scheduling timeslots and rooms... (1-2 minutes)</li>
                        <li><strong>Saving:</strong> Writing to database... (10-30 seconds)</li>
                        <li><strong>Complete!</strong> Redirecting to schedule view...</li>
                    </ol>
                    <p class="text-muted"><small>Check the terminal/console for detailed progress logs</small></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Links -->
    <div class="row mt-4">
        <div class="col-md-12">
            <h5>After Generation:</h5>
            <div class="list-group">
                <a href="{{ url_for('koordinator_schedule') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-calendar"></i> View Complete Schedule
                </a>
                <a href="{{ url_for('view_section_assignment') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-users"></i> View Section Assignments
                </a>
                <a href="{{ url_for('verify_no_conflicts') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-check-circle"></i> Verify No Conflicts
                </a>
                <a href="{{ url_for('lecturer_workload') }}" class="list-group-item list-group-item-action">
                    <i class="fas fa-chart-bar"></i> View Lecturer Workload
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 1rem;
    }
    
    .btn-lg {
        padding: 15px 40px;
        font-size: 1.2rem;
    }
    
    .list-group-item {
        transition: all 0.2s;
    }
    
    .list-group-item:hover {
        background-color: #f8f9fa;
        transform: translateX(5px);
    }
</style>
{% endblock %}
